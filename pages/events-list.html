<!DOCTYPE html>
<html lang="en">
<<<<<<< HEAD

=======
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Select Events – Evoka 2025</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/main.css?v=20251030">
  <style>
<<<<<<< HEAD
    /* Black Glass Background Effect */
    body {
      background-image: url('../assets/images/backgrounds/background.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      position: relative;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.75);  
      backdrop-filter: blur(52px);
      -webkit-backdrop-filter: blur(52px);
      z-index: -1;
    }
    
=======
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    .events-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin: 16px 0;
<<<<<<< HEAD
      padding-bottom: 32px;
      /* Default spacing; extra space only when summary is visible */
    }

=======
      padding-bottom: 32px; /* Default spacing; extra space only when summary is visible */
    }
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    @media (min-width: 768px) {
      .events-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
    }
<<<<<<< HEAD

=======
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    @media (min-width: 1024px) {
      .events-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
      }
    }
<<<<<<< HEAD

    .event-card {
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.12);
=======
    
    .event-card {
      background: rgba(0, 0, 0, 0.55);
      border: 1px solid rgba(255, 255, 255, 0.08);
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
      border-radius: 12px;
      padding: 14px;
      transition: all 0.3s ease;
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: center;
      min-height: 60px;
<<<<<<< HEAD
      backdrop-filter: blur(52px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: 0 10px 30px rgba(105, 88, 88, 0.35);
    }

    .event-card:hover {
      border-color: var(--primary);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

=======
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
    }
    
    .event-card:hover {
      border-color: var(--primary);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    .event-card.selected {
      border-color: var(--primary);
      background: rgba(123, 191, 68, 0.05);
    }
<<<<<<< HEAD

=======
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    .event-card .event-content {
      flex: 1;
      margin-right: 12px;
    }
<<<<<<< HEAD

    .event-card .event-title {
      font-size: 14px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 2px;
      line-height: 1.2;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    }

    .event-card .event-description {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.85);
      line-height: 1.3;
      margin-bottom: 0;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
    }

=======
    
    .event-card .event-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 2px;
      line-height: 1.2;
    }
    
    .event-card .event-description {
      font-size: 11px;
      color: var(--muted);
      line-height: 1.3;
      margin-bottom: 0;
    }
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    .event-card .event-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
<<<<<<< HEAD
      gap: 8px;
    }

    .participant-controls {
      display: none;
      align-items: center;
      gap: 12px;
      margin-top: 4px;
    }

    .participant-controls.show {
      display: flex;
    }

    .participant-btn {
      width: 40px;
      height: 40px;
      border: 2px solid var(--primary);
      background: rgba(123, 191, 68, 0.1);
      color: var(--primary);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .participant-btn:hover {
      background: var(--primary);
      color: #10210a;
    }

    .participant-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .participant-count {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
      min-width: 40px;
      text-align: center;
    }

    .event-price-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #4a90e2;
      color: #ffffff;
      padding: 6px 14px;
      border-radius: 18px;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 0.3px;
      border: 2px solid #357abd;
    }

    .select-btn {
      padding: 6px 14px;
      border: 2px solid #4a90e2;
      background: transparent;
      color: #4a90e2;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 11px;
      transition: all 0.2s ease;
      min-width: 70px;
      text-align: center;
      text-transform: capitalize;
      letter-spacing: 0.2px;
    }

    .select-btn:hover {
      background: #4a90e2;
      color: #ffffff;
      border-color: #357abd;
    }

    .select-btn.selected {
      background: #4a90e2;
      color: #ffffff;
      border-color: #357abd;
    }



=======
      gap: 6px;
    }
    
    .event-price-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      background: var(--primary);
      color: #10210a;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 700;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .select-btn {
      padding: 6px 12px;
      border: 1px solid var(--primary);
      background: transparent;
      color: var(--primary);
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      font-size: 11px;
      transition: all 0.3s ease;
      min-width: 65px;
      text-align: center;
    }
    
    .select-btn:hover {
      background: var(--primary);
      color: #10210a;
    }
    
    .select-btn.selected {
      background: var(--primary);
      color: #10210a;
    }
    
    .team-controls {
      display: none;
      align-items: center;
      gap: 8px;
    }

    .team-controls.show { display: flex; }

    .team-btn {
      width: 24px;
      height: 24px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,0.2);
      color: var(--text);
      cursor: pointer;
      font-weight: 700;
    }

    .team-size {
      min-width: 22px;
      text-align: center;
      font-weight: 700;
      color: var(--text);
      font-size: 12px;
    }
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    .selection-summary {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
<<<<<<< HEAD
      background: rgba(0, 0, 0, 0.85);
      border: 1px solid rgba(255, 255, 255, 0.15);
=======
      background: rgba(0, 0, 0, 0.55);
      border: 1px solid rgba(255, 255, 255, 0.08);
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
      border-radius: 12px 12px 0 0;
      padding: 16px;
      margin: 0;
      display: none;
      z-index: 1000;
<<<<<<< HEAD
      box-shadow: 0 -8px 30px rgba(0, 0, 0, 0.5);
      max-height: 50vh;
      overflow-y: auto;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    
    .selection-summary h3 {
      color: #fff;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    }

=======
      box-shadow: 0 -8px 30px rgba(0,0,0,0.35);
      max-height: 50vh;
      overflow-y: auto;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    .summary-totals {
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 12px;
      padding-top: 12px;
    }
<<<<<<< HEAD

=======
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      font-size: 14px;
<<<<<<< HEAD
      color: rgba(255, 255, 255, 0.9);
    }

=======
      color: var(--text);
    }
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    .summary-row.total {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 8px;
      padding-top: 8px;
    }
<<<<<<< HEAD

    .selection-summary.show {
      display: block;
    }

=======
    
    .selection-summary.show {
      display: block;
    }
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    .summary-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      font-size: 14px;
<<<<<<< HEAD
      color: rgba(255, 255, 255, 0.9);
    }
    
    .delete-event-btn:hover {
      color: #ff0000 !important;
      transform: scale(1.2);
    }

=======
    }
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    .user-info {
      background: rgba(0, 0, 0, 0.1);
      border: 1px solid var(--primary);
      border-radius: 6px;
      padding: 10px 12px;
      margin-bottom: 16px;
      display: inline-block;
    }
<<<<<<< HEAD

=======
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    .user-info h3 {
      margin: 0 0 4px 0;
      color: var(--primary);
      font-size: 14px;
    }
<<<<<<< HEAD

=======
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    .user-info p {
      margin: 2px 0;
      font-size: 12px;
      display: inline;
      margin-right: 12px;
    }
<<<<<<< HEAD

=======
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    .user-info-content {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
<<<<<<< HEAD

=======
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    /* Mobile optimizations */
    @media (max-width: 767px) {
      .container {
        padding: 0 12px;
      }
<<<<<<< HEAD

      .events-grid {
        gap: 10px;
        margin: 12px 0;
        padding-bottom: 240px;
      }

      .event-card {
        padding: 12px;
        min-height: 70px;
        flex-direction: column;
        align-items: flex-start;
      }
      
      .event-card .event-content {
        width: 100%;
        margin-right: 0;
        margin-bottom: 10px;
        padding-right: 90px;
      }

      .event-card .event-title {
        font-size: 14px;
        margin-bottom: 4px;
      }

      .event-card .event-description {
        font-size: 11px;
      }
      
      .event-card .event-actions {
        width: 100%;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }

      .select-btn {
        padding: 8px 16px;
        font-size: 12px;
        min-width: 75px;
      }
      
      .event-price-badge {
        top: 10px;
        right: 10px;
        padding: 5px 12px;
        font-size: 13px;
      }
      
      .participant-controls {
        gap: 10px;
        margin-top: 0;
      }
      
      .participant-btn {
        width: 36px;
        height: 36px;
        font-size: 18px;
      }
      
      .participant-count {
        font-size: 16px;
        min-width: 35px;
      }

=======
      
      .events-grid {
        gap: 6px;
        margin: 12px 0;
        padding-bottom: 220px;
      }
      
      .event-card {
        padding: 10px;
        min-height: 55px;
      }
      
      .event-card .event-title {
        font-size: 13px;
      }
      
      .event-card .event-description {
        font-size: 10px;
      }
      
      .select-btn {
        padding: 5px 10px;
        font-size: 10px;
        min-width: 60px;
      }
      
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
      .user-info {
        padding: 6px 8px;
        margin-bottom: 10px;
      }
<<<<<<< HEAD

      .user-info h3 {
        font-size: 12px;
      }

=======
      
      .user-info h3 {
        font-size: 12px;
      }
      
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
      .user-info p {
        font-size: 10px;
        margin-right: 6px;
      }
<<<<<<< HEAD
    }

=======
      

    }
    
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    /* Desktop optimizations */
    @media (min-width: 1200px) {
      .events-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    /* Add space for the fixed summary only when it's visible */
    body.has-summary .events-grid {
      padding-bottom: 220px;
    }

    /* Wider container for desktop to fit 3-4 columns nicely */
    @media (min-width: 1024px) {
      .container {
        max-width: 1200px;
      }
    }
  </style>
</head>
<<<<<<< HEAD

<body class="home-page">
  <main class="container" role="main">
=======
<body class="home-page">
  <main class="container" role="main">
    <nav aria-label="Progress" style="margin: 6px 0 8px 0;">
      <div style="display:flex; gap:8px; align-items:center; font-size:12px; color:var(--muted);">
        <span style="font-weight:700; color:var(--primary)">1</span>
        <span>Event Selection</span>
        <span>›</span>
        <span style="opacity:.75">2 Team Composition</span>
        <span>›</span>
        <span style="opacity:.75">3 Details</span>
      </div>
    </nav>
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    <header class="event-header">
      <div class="event-info">
        <div class="event-breadcrumb">
          <a href="../index.html">EVOKE 2K25</a> <span>/</span> <span>Select Events</span>
        </div>
        <h1 class="event-title">Choose Your Events</h1>
<<<<<<< HEAD
        <p class="event-subtitle">Select events and specify number of participants (₹100 per event pre-register<br>₹150 on-spot)</p>
      </div>
    </header>


=======
        <p class="event-subtitle">Select the events you want to participate in (₹100 per event pre-register / ₹150 on-spot)</p>
      </div>
    </header>

    <div id="userInfo" class="user-info" style="display: none;">
      <h3>Registration Details</h3>
      <div class="user-info-content">
        <p><strong>Name:</strong> <span id="userName"></span></p>
        <p><strong>Token:</strong> <span id="userToken"></span></p>
        <p><strong>College:</strong> <span id="userCollege"></span></p>
      </div>
    </div>
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4

    <div class="events-grid" id="eventsGrid">
      <!-- Events will be loaded here -->
    </div>

    <div class="selection-summary" id="selectionSummary">
      <h3 style="margin-top: 0;">Selected Events</h3>
      <div id="summaryItems"></div>
      <div class="summary-totals">
        <div class="summary-row">
          <span>Events Selected:</span>
          <span id="eventCount">0</span>
        </div>
        <div class="summary-row total">
          <span>Total Amount:</span>
          <span id="totalAmount">₹0</span>
        </div>
      </div>
<<<<<<< HEAD
      <div style="display: flex; gap: 12px; margin-top: 16px;">
        <button class="btn btn-secondary btn-block" id="clearSelections" style="flex: 1;">
          Clear All
        </button>
        <button class="btn btn-primary btn-block" id="proceedToPayment" style="flex: 2;">
          Proceed to Register
        </button>
      </div>
    </div>

    <div style="text-align: center; margin-top: 24px;">
      <a href="../index.html" class="login-link" style="font-size: 14px;">← Back to Home</a>
=======
      <button class="btn btn-primary btn-block" id="proceedToDetails" style="margin-top: 16px;">
        Continue to Details
      </button>
    </div>
    
    <div style="text-align: center; margin-top: 24px;">
      <a href="register.html" class="login-link" style="font-size: 14px;">← Back to Registration</a>
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    </div>
  </main>

  <!-- Page Loader -->
  <div id="pageLoader" class="page-loader" aria-live="polite" aria-busy="false">
    <div class="spinner-standalone" aria-hidden="true"></div>
    <div id="loaderText" class="loader-text">Loading events...</div>
  </div>

  <script type="module">
    import { db } from '../assets/js/firebase-config.js';
    import { collection, doc, setDoc, updateDoc, getDoc, getDocs, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

<<<<<<< HEAD
    // Event data with participant limits
    const EVENTS_DATA = [
      {
        id: 'dumb-charades',
        title: '1. Dumb Charades',
        description: 'Team of 2. Act without speaking; 1 minute per word.',
        minParticipants: 2,
        maxParticipants: 2
      },
      {
        id: 'general-quiz',
        title: '2. G.K. Quiz',
        description: 'Two per team. Prelims written; finals oral.',
        minParticipants: 2,
        maxParticipants: 2
      },
      {
        id: 'group-song',
        title: '3. Group Song',
        description: '3–5 members. Max 4 mins. Any language.',
        minParticipants: 3,
        maxParticipants: 5
      },
      {
        id: 'solo-singing',
        title: '4. Solo Song',
        description: 'Individual. Max 2 mins. Any language.',
        minParticipants: 1,
        maxParticipants: 1
      },
      {
        id: 'group-dance',
        title: '5. Group Dance',
        description: '2–5 members. Theme: Cinematic. 3+1 mins.',
        minParticipants: 2,
        maxParticipants: 5
      },
      {
        id: 'solo-dance',
        title: '6. Solo Dance',
        description: 'Individual. 4 mins. Free Style.',
        minParticipants: 1,
        maxParticipants: 1
      },
      {
        id: 'face-painting',
        title: '7. Face Painting',
        description: 'Team of 2 (one paints on the other). 1 hour.',
        minParticipants: 2,
        maxParticipants: 2
      },
      {
        id: 'fireless-cooking',
        title: '8. Cooking Without Fire',
        description: 'Individual. 1½ hours. No fire; own utensils.',
        minParticipants: 1,
        maxParticipants: 1
      },
      {
        id: 'vegetable-carving',
        title: '9. Vegetable Carving',
        description: 'Individual. 1 hour. Bring own veggies and tools.',
        minParticipants: 1,
        maxParticipants: 1
      },
      {
        id: 'pot-painting',
        title: '10. Pot Painting',
        description: 'Pot provided. 1 hour. Only hand painting.',
        minParticipants: 1,
        maxParticipants: 1
      },
      {
        id: 'art-craft',
        title: '11. Art and Craft',
        description: 'Individual. Bring own materials. 1 hour.',
        minParticipants: 1,
        maxParticipants: 1
      },
      {
        id: 'collage-competition',
        title: '12. Collage Competition',
        description: 'Team of 2 members. Theme on the spot. 1 hour.',
        minParticipants: 2,
        maxParticipants: 2
      },
      {
        id: 'pencil-sketch',
        title: '13. Pencil Sketch',
        description: 'Individual. Theme on the spot. Papers provided.',
        minParticipants: 1,
        maxParticipants: 1
      },
      {
        id: 'best-waste',
        title: '14. Best Out of Waste',
        description: 'Individual. 1½ hours. Only waste/recyclable materials.',
        minParticipants: 1,
        maxParticipants: 1
      },
      {
        id: 'fashion-show',
        title: '15. Fashion Show (Indian Culture)',
        description: 'Individual. Modest attire, props allowed. 30s on stage.',
        minParticipants: 1,
        maxParticipants: 1
      },
      {
        id: 'solo-instrumental',
        title: '16. Instrumental Music',
        description: 'Individual. Bring your own instruments. 3 minutes.',
        minParticipants: 1,
        maxParticipants: 1
      }
    ];

=======
    // Event data
    const EVENTS_DATA = [
      {
        id: 'dumb-charades',
        title: 'Dumb Charades',
        description: 'Team of 2. Act without speaking; 1 minute per word. 10 prompts, need 8 correct to qualify.',
        minParticipants: 2,
        maxParticipants: 2,
        capacity: 100
      },
      {
        id: 'general-quiz',
        title: 'G.K. Quiz',
        description: 'Two per team. Prelims written; finals oral. Includes Aptitude, Current Affairs, Sports, Science and more.',
        minParticipants: 2,
        maxParticipants: 2,
        capacity: 100
      },
      {
        id: 'fashion-show',
        title: 'Fashion Show (Indian Culture)',
        description: 'Individual. Modest attire, props allowed. 30s on stage.',
        minParticipants: 1,
        maxParticipants: 1,
        capacity: 100
      },
      {
        id: 'group-song',
        title: 'Group Song',
        description: '3–5 members. Max 4 mins. Any language; judged on vocals, musicality, presence and style.',
        minParticipants: 3,
        maxParticipants: 5,
        capacity: 40
      },
      {
        id: 'solo-singing',
        title: 'Solo Song',
        description: 'Individual. Max 2 mins. Any language; decent content. Own track/karaoke allowed.',
        minParticipants: 1,
        maxParticipants: 1,
        capacity: 200
      },
      {
        id: 'group-dance',
        title: 'Group Dance',
        description: '2–5 members. Theme: Cinematic. 3+1 mins; fusion allowed; no religious acts.',
        minParticipants: 2,
        maxParticipants: 5,
        capacity: 40
      },
      {
        id: 'solo-dance',
        title: 'Solo Dance',
        description: 'Individual. 4 mins. Free Style. Fusion allowed. No religious acts; decent performance.',
        minParticipants: 1,
        maxParticipants: 1,
        capacity: 200
      },
      {
        id: 'solo-instrumental',
        title: 'Instrumental Music',
        description: 'Individual. Bring your own instruments. Time limit 3 minutes.',
        minParticipants: 1,
        maxParticipants: 1,
        capacity: 100
      },
      {
        id: 'face-painting',
        title: 'Face Painting',
        description: 'Team of 2 (one paints on the other). Time limit 1 hour. Free Theme.',
        minParticipants: 2,
        maxParticipants: 2,
        capacity: 60
      },
      {
        id: 'fireless-cooking',
        title: 'Cooking Without Fire',
        description: 'Individual. 1½ hours. No fire; own utensils; no precooked items; creativity judged.',
        minParticipants: 1,
        maxParticipants: 1,
        capacity: 80
      },
      {
        id: 'vegetable-carving',
        title: 'Vegetable Carving',
        description: 'Individual. 1 hour. Bring own veggies and tools; follow given theme.',
        minParticipants: 1,
        maxParticipants: 1,
        capacity: 80
      },
      {
        id: 'pot-painting',
        title: 'Pot Painting',
        description: 'Pot provided. 1 hour. Only hand painting; bring materials; no spray paint.',
        minParticipants: 1,
        maxParticipants: 1,
        capacity: 80
      },
      {
        id: 'art-craft',
        title: 'Art and Craft',
        description: 'Individual. Bring own materials and tools. Time: 1 hour. Original work only.',
        minParticipants: 1,
        maxParticipants: 1,
        capacity: 120
      },
      {
        id: 'collage-competition',
        title: 'Collage Competition',
        description: 'Team of ≥2. Theme on the spot. Time 1 hour. Charts provided. Handmade only.',
        minParticipants: 2,
        maxParticipants: 4,
        capacity: 100
      },
      {
        id: 'pencil-sketch',
        title: 'Pencil Sketch',
        description: 'Individual. Theme on the spot. Papers provided. Graphite/charcoal only.',
        minParticipants: 1,
        maxParticipants: 1,
        capacity: 150
      },
      {
        id: 'best-waste',
        title: 'Best Out of Waste',
        description: 'Individual. 1½ hours. Only waste/recyclable materials; eco-friendly models.',
        minParticipants: 1,
        maxParticipants: 1,
        capacity: 120
      }
    ];

    // selectedEvents: { [eventId]: { teamSize: number } }
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    let selectedEvents = {};
    let userContext = null;

    // DOM elements
    const eventsGrid = document.getElementById('eventsGrid');
    const selectionSummary = document.getElementById('selectionSummary');
    const summaryItems = document.getElementById('summaryItems');
<<<<<<< HEAD
    const proceedBtn = document.getElementById('proceedToPayment');
=======
    const proceedBtn = document.getElementById('proceedToDetails');
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
    const pageLoader = document.getElementById('pageLoader');
    const userInfo = document.getElementById('userInfo');

    function showLoader(message) {
      document.getElementById('loaderText').textContent = message || 'Loading...';
      pageLoader.classList.add('show');
    }

    function hideLoader() {
      pageLoader.classList.remove('show');
    }

    // Get user context from session storage
    function getUserContext() {
      try {
        const token = sessionStorage.getItem('lastToken');
        const name = sessionStorage.getItem('lastName');
        const college = sessionStorage.getItem('lastCollege');
<<<<<<< HEAD

=======
        
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
        if (token && name) {
          return { token, name, college: college || 'N/A' };
        }
        return null;
      } catch (e) {
        console.warn('Unable to get user context:', e);
        return null;
      }
    }

    // Check if user already submitted events; if yes, skip this page
    function enforceSubmissionLock() {
      try {
        const token = sessionStorage.getItem('lastToken');
        const lockedToken = sessionStorage.getItem('events_submitted_token');
        if (token && lockedToken && token === lockedToken) {
          // Already submitted, redirect to success page
          window.location.replace('success.html');
          return true;
        }
      } catch (e) {
        console.warn('Lock check failed:', e);
      }
      return false;
    }

    // Display user information
    function displayUserInfo() {
      userContext = getUserContext();
<<<<<<< HEAD
      if (!userContext) {
        // No user context - this is first time, allow them to proceed
        console.log('No user context found - new user flow');
=======
      if (userContext) {
        document.getElementById('userName').textContent = userContext.name;
        document.getElementById('userToken').textContent = userContext.token;
        document.getElementById('userCollege').textContent = userContext.college;
        userInfo.style.display = 'block';
      } else {
        // Redirect to registration if no user context
        alert('Please complete registration first.');
        window.location.href = 'register.html';
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
      }
    }

    // Render events grid
    function renderEvents() {
      eventsGrid.innerHTML = '';
<<<<<<< HEAD

=======
      
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
      EVENTS_DATA.forEach(event => {
        const eventCard = document.createElement('div');
        eventCard.className = 'event-card';
        eventCard.dataset.eventId = event.id;
<<<<<<< HEAD

        const participantInfo = event.minParticipants === event.maxParticipants
          ? `${event.maxParticipants} member${event.maxParticipants > 1 ? 's' : ''}`
          : `${event.minParticipants}-${event.maxParticipants} members`;

=======
        
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
        eventCard.innerHTML = `
          <div class="event-price-badge">₹100</div>
          <div class="event-content">
            <div class="event-title">${event.title}</div>
<<<<<<< HEAD
            <div class="event-description">${event.description} (${participantInfo})</div>
          </div>
          <div class="event-actions">
            <button class="select-btn" data-event-id="${event.id}">Select</button>
            <div class="participant-controls" data-event-id="${event.id}">
              <button class="participant-btn minus" data-action="minus">−</button>
              <span class="participant-count">${event.minParticipants}</span>
              <button class="participant-btn plus" data-action="plus">+</button>
            </div>
          </div>
        `;

=======
            <div class="event-description">${event.description} • Team ${event.minParticipants === event.maxParticipants ? event.maxParticipants : `${event.minParticipants}–${event.maxParticipants}`}</div>
          </div>
          <div class="event-actions">
            <button class="select-btn" data-event-id="${event.id}">Select</button>
            <div class="team-controls" id="tc-${event.id}" aria-live="polite">
              <button class="team-btn" data-op="-" data-event-id="${event.id}" aria-label="Decrease team size">−</button>
              <span class="team-size" id="ts-${event.id}">${event.minParticipants || 1}</span>
              <button class="team-btn" data-op="+" data-event-id="${event.id}" aria-label="Increase team size">+</button>
            </div>
          </div>
        `;
        
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
        // Add select button handler
        const selectBtn = eventCard.querySelector('.select-btn');
        selectBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          toggleEventSelection(event.id);
        });

<<<<<<< HEAD
        // Add participant control handlers
        const participantControls = eventCard.querySelector('.participant-controls');
        const minusBtn = participantControls.querySelector('.minus');
        const plusBtn = participantControls.querySelector('.plus');
        const countSpan = participantControls.querySelector('.participant-count');

        minusBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          updateParticipantCount(event.id, -1);
        });

        plusBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          updateParticipantCount(event.id, 1);
        });

=======
        // Add team control handlers
        const decBtn = eventCard.querySelector(`.team-btn[data-op="-"][data-event-id="${event.id}"]`);
        const incBtn = eventCard.querySelector(`.team-btn[data-op="+"][data-event-id="${event.id}"]`);
        decBtn.addEventListener('click', (e) => { e.stopPropagation(); adjustTeam(event.id, -1); });
        incBtn.addEventListener('click', (e) => { e.stopPropagation(); adjustTeam(event.id, +1); });
        
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
        eventsGrid.appendChild(eventCard);
      });
    }

    // Toggle event selection
    function toggleEventSelection(eventId) {
      console.log('Toggling event:', eventId);
<<<<<<< HEAD
      const event = EVENTS_DATA.find(e => e.id === eventId);
      const eventCard = document.querySelector(`.event-card[data-event-id="${eventId}"]`);
      const selectBtn = eventCard.querySelector('.select-btn');
      const participantControls = eventCard.querySelector('.participant-controls');

=======
      const eventCard = document.querySelector(`[data-event-id="${eventId}"]`);
      const selectBtn = eventCard.querySelector('.select-btn');
      const teamControls = document.getElementById(`tc-${eventId}`);
      const eventMeta = EVENTS_DATA.find(e => e.id === eventId);
      
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
      if (selectedEvents[eventId]) {
        // Deselect event
        delete selectedEvents[eventId];
        eventCard.classList.remove('selected');
        selectBtn.classList.remove('selected');
        selectBtn.textContent = 'Select';
<<<<<<< HEAD
        participantControls.classList.remove('show');
      } else {
        // Select event with minimum participants
        selectedEvents[eventId] = event.minParticipants;
        eventCard.classList.add('selected');
        selectBtn.classList.add('selected');
        selectBtn.textContent = 'Selected';
        participantControls.classList.add('show');

        // Update the count display
        const countSpan = participantControls.querySelector('.participant-count');
        countSpan.textContent = event.minParticipants;

        // Update button states
        updateParticipantButtons(eventId);
      }

=======
        teamControls?.classList.remove('show');
      } else {
        // Select event with default quantity of 1
        const defaultTeam = Math.max(1, eventMeta?.minParticipants || 1);
        selectedEvents[eventId] = { teamSize: defaultTeam };
        eventCard.classList.add('selected');
        selectBtn.classList.add('selected');
        selectBtn.textContent = 'Unselect';
        teamControls?.classList.add('show');
        const ts = document.getElementById(`ts-${eventId}`);
        if (ts) ts.textContent = String(defaultTeam);
      }
      
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
      console.log('Current selected events:', selectedEvents);
      updateSelectionSummary();
    }

<<<<<<< HEAD
    // Update participant count
    function updateParticipantCount(eventId, delta) {
      const event = EVENTS_DATA.find(e => e.id === eventId);
      if (!selectedEvents[eventId]) return;

      const newCount = selectedEvents[eventId] + delta;

      // Validate against min/max
      if (newCount < event.minParticipants || newCount > event.maxParticipants) {
        return;
      }

      selectedEvents[eventId] = newCount;

      // Update UI
      const eventCard = document.querySelector(`.event-card[data-event-id="${eventId}"]`);
      const countSpan = eventCard.querySelector('.participant-count');
      countSpan.textContent = newCount;

      updateParticipantButtons(eventId);
      updateSelectionSummary();
    }

    // Update participant button states
    function updateParticipantButtons(eventId) {
      const event = EVENTS_DATA.find(e => e.id === eventId);
      const eventCard = document.querySelector(`.event-card[data-event-id="${eventId}"]`);
      const participantControls = eventCard.querySelector('.participant-controls');
      const minusBtn = participantControls.querySelector('.minus');
      const plusBtn = participantControls.querySelector('.plus');

      const currentCount = selectedEvents[eventId];

      minusBtn.disabled = currentCount <= event.minParticipants;
      plusBtn.disabled = currentCount >= event.maxParticipants;
    }

    // Update selection summary
    function updateSelectionSummary() {
      const hasSelections = Object.keys(selectedEvents).length > 0;

      if (hasSelections) {
        selectionSummary.classList.add('show');
        document.body.classList.add('has-summary');

        let summaryHTML = '';

        Object.entries(selectedEvents).forEach(([eventId, participantCount]) => {
          const event = EVENTS_DATA.find(e => e.id === eventId);

          summaryHTML += `
            <div class="summary-item">
              <span>${event.title}</span>
              <div style="display: flex; align-items: center; gap: 8px;">
                <span>${participantCount} participant${participantCount > 1 ? 's' : ''}</span>
                <button class="delete-event-btn" data-event-id="${eventId}" style="background: transparent; border: none; color: #ff4444; cursor: pointer; font-size: 18px; padding: 4px; line-height: 1;">×</button>
              </div>
            </div>
          `;
        });

        summaryItems.innerHTML = summaryHTML;
        
        // Add delete button handlers
        document.querySelectorAll('.delete-event-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const eventId = btn.getAttribute('data-event-id');
            toggleEventSelection(eventId);
          });
        });

        // Calculate event count and total amount
        const eventCount = Object.keys(selectedEvents).length;
        const totalAmount = eventCount * 100;

        // Update DOM elements
        document.getElementById('eventCount').textContent = eventCount;
        document.getElementById('totalAmount').textContent = `₹${totalAmount}`;

        // Store in sessionStorage
        sessionStorage.setItem('eventCount', String(eventCount));
        sessionStorage.setItem('totalAmount', String(totalAmount));

      } else {
        selectionSummary.classList.remove('show');
        document.body.classList.remove('has-summary');

        // Reset values when no events selected
        sessionStorage.setItem('eventCount', '0');
        sessionStorage.setItem('totalAmount', '0');
      }
    }

    // Proceed to payment
    async function proceedToPayment() {
      console.log('Submit button clicked!');
      console.log('Selected events:', selectedEvents);

=======
    function adjustTeam(eventId, delta) {
      const meta = EVENTS_DATA.find(e => e.id === eventId);
      if (!meta || !selectedEvents[eventId]) return;
      const min = meta.minParticipants || 1;
      const max = meta.maxParticipants || 1;
      const next = Math.max(min, Math.min(max, (selectedEvents[eventId].teamSize || min) + delta));
      if (next === selectedEvents[eventId].teamSize) {
        if (delta > 0) alert(`Max team size reached (${max}).`);
        if (delta < 0) alert(`Min team size is ${min}.`);
        return;
      }
      selectedEvents[eventId].teamSize = next;
      const ts = document.getElementById(`ts-${eventId}`);
      if (ts) ts.textContent = String(next);
      updateSelectionSummary();
    }

    // Update selection summary
    function updateSelectionSummary() {
      const hasSelections = Object.keys(selectedEvents).length > 0;
      
      if (hasSelections) {
        selectionSummary.classList.add('show');
        document.body.classList.add('has-summary');
        
        let summaryHTML = '';
        
        Object.entries(selectedEvents).forEach(([eventId, data]) => {
          const event = EVENTS_DATA.find(e => e.id === eventId);
          
          summaryHTML += `
            <div class="summary-item">
              <span>${event.title}</span>
              <span>
                <button class="team-btn" onclick="return false" data-sum-dec="${event.id}">−</button>
                <strong style="margin:0 6px;">${data.teamSize}</strong>
                <button class="team-btn" onclick="return false" data-sum-inc="${event.id}">+</button>
              </span>
            </div>
          `;
        });
        
        summaryItems.innerHTML = summaryHTML;
        // Wire summary +/- buttons
        summaryItems.querySelectorAll('[data-sum-dec]').forEach(btn => btn.addEventListener('click', (e)=>{
          const id = e.currentTarget.getAttribute('data-sum-dec');
          adjustTeam(id, -1);
        }));
        summaryItems.querySelectorAll('[data-sum-inc]').forEach(btn => btn.addEventListener('click', (e)=>{
          const id = e.currentTarget.getAttribute('data-sum-inc');
          adjustTeam(id, +1);
        }));
        
        // Calculate event count and total amount
        const eventCount = Object.keys(selectedEvents).length;
        const totalAmount = eventCount * 100;
        
        // Update DOM elements
        document.getElementById('eventCount').textContent = eventCount;
        document.getElementById('totalAmount').textContent = `₹${totalAmount}`;
        
        // Store in sessionStorage
        sessionStorage.setItem('eventCount', String(eventCount));
        sessionStorage.setItem('totalAmount', String(totalAmount));
        sessionStorage.setItem('selectedEvents', JSON.stringify(selectedEvents));
        
      } else {
        selectionSummary.classList.remove('show');
        document.body.classList.remove('has-summary');
        
        // Reset values when no events selected
        sessionStorage.setItem('eventCount', '0');
        sessionStorage.setItem('totalAmount', '0');
        sessionStorage.removeItem('selectedEvents');
      }
    }

    // Proceed to details
    async function proceedToDetails() {
      console.log('Submit button clicked!');
      console.log('Selected events:', selectedEvents);
      
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
      if (Object.keys(selectedEvents).length === 0) {
        console.warn('No events selected');
        alert('Please select at least one event.');
        return;
      }

      if (!userContext) {
<<<<<<< HEAD
        console.log('No user context - storing selections and redirecting to registration');
        // Store selections for after registration
        sessionStorage.setItem('pendingEventSelections', JSON.stringify(selectedEvents));
        sessionStorage.setItem('eventCount', String(Object.keys(selectedEvents).length));
        sessionStorage.setItem('totalAmount', String(Object.keys(selectedEvents).length * 100));

        // Redirect to registration - user will come back here after registering
=======
        console.warn('No user context found');
        alert('User session expired. Please register again.');
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
        window.location.href = 'register.html';
        return;
      }

      console.log('User context:', userContext);
      showLoader('Saving your event selections...');

      try {
<<<<<<< HEAD
        // Prepare event selections with participant counts
        const eventSelections = [];

        Object.entries(selectedEvents).forEach(([eventId, participantCount]) => {
          const event = EVENTS_DATA.find(e => e.id === eventId);

          eventSelections.push({
            eventId,
            eventTitle: event.title,
            participantCount,
            minParticipants: event.minParticipants,
            maxParticipants: event.maxParticipants
=======
        // Prepare event selections without pricing
        const eventSelections = [];

        Object.entries(selectedEvents).forEach(([eventId, data]) => {
          const event = EVENTS_DATA.find(e => e.id === eventId);
          
          eventSelections.push({
            eventId,
            eventTitle: event.title,
            teamSize: data.teamSize,
            minParticipants: event.minParticipants,
            maxParticipants: event.maxParticipants,
            capacity: event.capacity
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
          });
        });

        console.log('Event selections prepared:', eventSelections);

        // Find user by shortId
        const registrationsRef = collection(db, 'registrations');
        const querySnapshot = await getDocs(query(registrationsRef, where('shortId', '==', userContext.token)));
        console.log('Query snapshot:', querySnapshot);

        if (querySnapshot.empty) {
          throw new Error('User registration not found. Please register again.');
        }

        // Use the first matching document
        const userDocData = querySnapshot.docs[0];
        console.log('User document found:', userDocData.id);

        // Calculate total amount and event count
        const eventCount = Object.keys(selectedEvents).length;
        const totalAmount = eventCount * 100;
        console.log('Event count:', eventCount);
        console.log('Total amount calculated:', totalAmount);
<<<<<<< HEAD

=======
        
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
        // Ensure sessionStorage has the latest values
        sessionStorage.setItem('eventCount', String(eventCount));
        sessionStorage.setItem('totalAmount', String(totalAmount));

        // Persist selections in eventSelections (rules allow create here)
        const eventSelectionsRef = collection(db, 'eventSelections');
        const selectionDocRef = doc(eventSelectionsRef, `${userContext.token}_${Date.now()}`);
        console.log('Creating selection document:', selectionDocRef.id);
        await setDoc(selectionDocRef, {
          userId: userDocData.id,
          userToken: userContext.token,
          selections: eventSelections,
          eventCount: eventCount,
          totalAmount: totalAmount,
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp(),
          paymentStatus: 'pending'
        });
        console.log('Selection document created successfully');

        // Best-effort: link selection to registration (ignore if denied by rules)
        try {
<<<<<<< HEAD
          console.log('Attempting to update registration document with event selection metadata');
=======
          console.log('Attempting to update registration document');
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
          await updateDoc(userDocData.ref, {
            hasSelectedEvents: true,
            eventSelectionId: selectionDocRef.id,
            eventSelectionTimestamp: serverTimestamp(),
            eventCount: eventCount,
            totalAmount: totalAmount
          });
<<<<<<< HEAD
          console.log('Registration document updated successfully with event metadata');
        } catch (linkErr) {
          console.warn('Could not update registration document (this is okay, event data is saved in eventSelections collection):', linkErr?.message || linkErr);
          // This is not a critical error - the event selections are already saved in the eventSelections collection
          // The admin panel will still be able to see the events via the eventSelections collection
        }

        // Store selections in session storage for payment page
=======
          console.log('Registration document updated successfully');
        } catch (linkErr) {
          console.warn('Linking selection to registration was skipped due to rules:', linkErr?.message || linkErr);
        }

        // Store selections in session storage for next step
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
        sessionStorage.setItem('eventSelections', JSON.stringify(eventSelections));
        sessionStorage.setItem('totalAmount', String(totalAmount));
        sessionStorage.setItem('payment_user_context', JSON.stringify({
          name: userContext.name,
          token: userContext.token,
          college: userContext.college
        }));
        console.log('Session storage updated');

        hideLoader();

        // Set submission lock so user cannot come back and resubmit
        try {
          sessionStorage.setItem('events_submitted_token', userContext.token);
          sessionStorage.setItem('events_submitted_time', String(Date.now()));
        } catch (e) { console.warn('Failed to set submission lock:', e); }

<<<<<<< HEAD
        // Redirect to payment page
        console.log('Redirecting to payment page');
        window.location.href = 'success.html';
=======
        // Redirect to details page
        console.log('Redirecting to details page');
        window.location.href = 'participant-details.html';
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4

      } catch (error) {
        console.error('Error saving event selections:', {
          message: error?.message || String(error),
          code: error?.code,
          stack: error?.stack
        });
        hideLoader();
        alert('Failed to save event selections. Please try again. Error: ' + (error?.message || 'Unknown error'));
      }
    }

    // Initialize page
    function init() {
      console.log('Initializing events page...');
<<<<<<< HEAD

=======
      
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
      // If already submitted, redirect to success immediately
      if (enforceSubmissionLock()) return;

      displayUserInfo();
      renderEvents();
<<<<<<< HEAD

      // Check if there are pending selections from a previous visit
      try {
        const pendingSelections = sessionStorage.getItem('pendingEventSelections');
        if (pendingSelections) {
          selectedEvents = JSON.parse(pendingSelections);
          console.log('Restored pending selections:', selectedEvents);

          // Update UI to reflect restored selections
          Object.keys(selectedEvents).forEach(eventId => {
            const eventCard = document.querySelector(`.event-card[data-event-id="${eventId}"]`);
            if (eventCard) {
              const selectBtn = eventCard.querySelector('.select-btn');
              const participantControls = eventCard.querySelector('.participant-controls');
              const countSpan = participantControls.querySelector('.participant-count');

              eventCard.classList.add('selected');
              selectBtn.classList.add('selected');
              selectBtn.textContent = 'Selected';
              participantControls.classList.add('show');
              countSpan.textContent = selectedEvents[eventId];
              updateParticipantButtons(eventId);
            }
          });

          updateSelectionSummary();
          // If the user has returned from registration and we have context, auto-proceed
          if (getUserContext()) {
            console.log('User context present with pending selections — auto-submitting to save and continue');
            proceedToPayment();
          }
        }
      } catch (e) {
        console.warn('Failed to restore pending selections:', e);
      }

      // Add proceed button handler
      if (proceedBtn) {
        console.log('Submit button found, adding click handler');
        proceedBtn.addEventListener('click', proceedToPayment);
=======
      
      // Add proceed button handler
      if (proceedBtn) {
        console.log('Submit button found, adding click handler');
        proceedBtn.addEventListener('click', proceedToDetails);
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
        console.log('Click handler attached successfully');
      } else {
        console.error('Submit button not found!');
      }
<<<<<<< HEAD
      
      // Add clear all button handler
      const clearBtn = document.getElementById('clearSelections');
      if (clearBtn) {
        clearBtn.addEventListener('click', () => {
          if (Object.keys(selectedEvents).length === 0) {
            return;
          }
          
          // Clear all selections
          Object.keys(selectedEvents).forEach(eventId => {
            const eventCard = document.querySelector(`.event-card[data-event-id="${eventId}"]`);
            if (eventCard) {
              const selectBtn = eventCard.querySelector('.select-btn');
              const participantControls = eventCard.querySelector('.participant-controls');
              
              eventCard.classList.remove('selected');
              selectBtn.classList.remove('selected');
              selectBtn.textContent = 'Select';
              participantControls.classList.remove('show');
            }
          });
          
          selectedEvents = {};
          updateSelectionSummary();
          
          // Clear pending selections from storage
          try {
            sessionStorage.removeItem('pendingEventSelections');
          } catch (e) {
            console.warn('Failed to clear pending selections:', e);
          }
        });
      }
=======
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4

      // Handle back-forward cache returns: re-check lock and redirect if needed
      window.addEventListener('pageshow', () => {
        enforceSubmissionLock();
      });
    }

    // Global error handler
    window.addEventListener('error', (e) => {
      console.error('Global error:', e.error);
      console.error('Error message:', e.message);
      console.error('Error filename:', e.filename);
      console.error('Error line:', e.lineno);
    });

    // Start the application
    try {
      init();
    } catch (e) {
      console.error('Failed to initialize:', e);
      alert('Failed to load page. Please refresh and try again.');
    }
  </script>
</body>
<<<<<<< HEAD

</html>

=======
</html>
>>>>>>> 19d0a708fe004e1650bebad7a1a8f14eba6a6ed4
